<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroVest | Professional Asset Terminal</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        :root {
            --bg-deep: #020617; --bg-surface: #0f172a; --bg-card: #1e293b;
            --accent: #38bdf8; --text-main: #f8fafc; --text-dim: #94a3b8;
            --success: #22c55e; --danger: #ef4444; --border: rgba(255, 255, 255, 0.08);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg-deep); color: var(--text-main); display: flex; height: 100vh; overflow: hidden; }

        /* --- SIDEBAR --- */
        nav { width: 72px; background: #000; border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding: 24px 0; gap: 32px; }
        .nav-icon { font-size: 24px; color: var(--text-dim); cursor: pointer; transition: 0.2s; padding: 12px; border-radius: 12px; }
        .nav-icon.active { color: var(--accent); background: rgba(56, 189, 248, 0.1); }

        /* --- DASHBOARD HEADER --- */
        main { flex-grow: 1; display: flex; flex-direction: column; background: radial-gradient(circle at top right, #0c4a6e, transparent); }
        
        .top-nav { height: 70px; display: flex; align-items: center; justify-content: space-between; padding: 0 30px; border-bottom: 1px solid var(--border); background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px); }
        .search-wrap { background: var(--bg-deep); border: 1px solid var(--border); border-radius: 8px; width: 400px; padding: 10px 15px; display: flex; align-items: center; }
        .search-wrap input { background: transparent; border: none; color: white; outline: none; margin-left: 10px; width: 100%; font-size: 14px; }

        /* --- WEALTH METRICS --- */
        .wealth-bar { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1px; background: var(--border); border-bottom: 1px solid var(--border); }
        .metric-card { background: var(--bg-surface); padding: 20px 30px; }
        .metric-label { font-size: 11px; font-weight: 800; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; }
        .metric-value { font-size: 22px; font-weight: 800; margin-top: 4px; }

        /* --- MAIN WORKSPACE --- */
        .workspace { display: grid; grid-template-columns: 1fr 380px; flex-grow: 1; overflow: hidden; }
        #chart-box { background: #000; border-right: 1px solid var(--border); }

        .order-panel { background: var(--bg-surface); padding: 24px; display: flex; flex-direction: column; gap: 20px; }
        .trade-input { background: var(--bg-deep); border: 1px solid var(--border); padding: 14px; border-radius: 8px; color: white; width: 100%; margin-top: 10px; font-size: 16px; font-weight: 700; }
        
        .btn-trade { padding: 16px; border-radius: 8px; border: none; font-weight: 800; cursor: pointer; font-size: 14px; transition: 0.3s; }
        .buy { background: var(--success); color: white; }
        .sell { background: var(--danger); color: white; }
        .buy:hover { box-shadow: 0 0 20px rgba(34, 197, 94, 0.4); }

        /* --- ASSETS TABLE --- */
        .assets-area { height: 300px; background: #020617; border-top: 1px solid var(--border); padding: 25px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; font-size: 11px; color: var(--text-dim); padding-bottom: 15px; border-bottom: 1px solid var(--border); }
        td { padding: 15px 0; border-bottom: 1px solid rgba(255,255,255,0.03); font-size: 14px; }

        .status-pill { padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 900; }
        .gain { background: rgba(34, 197, 94, 0.1); color: var(--success); }
        .loss { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
    </style>
</head>
<body>

    <nav>
        <div style="font-weight: 900; color: var(--accent); font-size: 24px; margin-bottom: 20px;">NV</div>
        <i class="ph ph-activity nav-icon active"></i>
        <i class="ph ph-wallet nav-icon"></i>
        <i class="ph ph-chart-pie nav-icon"></i>
        <i class="ph ph-gear nav-icon" style="margin-top: auto;"></i>
    </nav>

    <main>
        <header class="top-nav">
            <div class="search-wrap">
                <i class="ph ph-magnifying-glass" style="color: var(--text-dim)"></i>
                <input type="text" id="symbolIn" placeholder="Search Markets (e.g. NVDA, BTCUSD, TSLA)..." onkeypress="if(event.key==='Enter') executeLookup()">
            </div>
            <div id="marketStatus" style="font-size: 12px; font-weight: 700; color: var(--success);">● LIVE MARKET DATA ENABLED</div>
        </header>

        <div class="wealth-bar">
            <div class="metric-card">
                <div class="metric-label">Total Net Worth</div>
                <div id="netWorth" class="metric-value">$0.00</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Buying Power (Cash)</div>
                <div id="cashBal" class="metric-value" style="color: var(--accent);">$0.00</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Invested Capital</div>
                <div id="totalInvested" class="metric-value">$0.00</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Unrealized P&L</div>
                <div id="totalPnL" class="metric-value">$0.00</div>
            </div>
        </div>

        <div class="workspace">
            <div id="chart-box"></div>

            <div class="order-panel">
                <div style="margin-bottom: 10px;">
                    <h2 id="activeSym" style="font-size: 28px;">AAPL</h2>
                    <p id="activeName" style="color: var(--text-dim); font-size: 13px;">Apple Inc. • NASDAQ</p>
                </div>

                <div style="background: var(--bg-deep); padding: 15px; border-radius: 12px; border: 1px solid var(--border);">
                    <div style="font-size: 11px; font-weight: 800; color: var(--text-dim);">LAST MARKET PRICE</div>
                    <div id="curPrice" style="font-size: 32px; font-weight: 900; margin: 5px 0;">$0.00</div>
                    <div id="curChange" style="font-size: 14px; font-weight: 700;">+0.00%</div>
                </div>

                <div>
                    <label class="metric-label">Order Quantity</label>
                    <input type="number" id="tradeQty" class="trade-input" value="1">
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <button class="btn-trade buy" onclick="executeTrade('BUY')">BUY ASSET</button>
                    <button class="btn-trade sell" onclick="executeTrade('SELL')">SELL ASSET</button>
                </div>

                <div style="margin-top: auto; padding: 15px; background: rgba(56, 189, 248, 0.05); border-radius: 8px;">
                    <p style="font-size: 12px; color: var(--accent); line-height: 1.5;">
                        <b>Oracle Insight:</b> Select a ticker to see AI-powered risk assessment and technical trends.
                    </p>
                </div>
            </div>
        </div>

        <div class="assets-area">
            <h3 style="margin-bottom: 20px; font-size: 14px; letter-spacing: 1px;">MY OWNED ASSETS</h3>
            <table>
                <thead>
                    <tr>
                        <th>Symbol</th>
                        <th>Shares</th>
                        <th>Avg Price</th>
                        <th>Current Price</th>
                        <th>Investment</th>
                        <th>Return ($)</th>
                        <th>Return (%)</th>
                    </tr>
                </thead>
                <tbody id="assetTable">
                    </tbody>
            </table>
        </div>
    </main>

    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <script>
        // --- CORE SYSTEM DATA ---
        const ALPHA_KEY = "PQ6UXBMB968IQCIM";
        
        // Initialize state from local storage or defaults
        let state = JSON.parse(localStorage.getItem('nv_enterprise_v1')) || {
            cash: 50000.00,
            portfolio: [] // { sym, qty, avgCost }
        };

        let currentMarketPrice = 0;

        // --- TRADING ENGINE ---
        async function fetchPrice(symbol) {
            try {
                const res = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=${ALPHA_KEY}`);
                const data = await res.json();
                const quote = data["Global Quote"];
                if(quote) {
                    currentMarketPrice = parseFloat(quote["05. price"]);
                    const change = quote["10. change percent"];
                    
                    document.getElementById('curPrice').innerText = `$${currentMarketPrice.toFixed(2)}`;
                    document.getElementById('curChange').innerText = change;
                    document.getElementById('curChange').style.color = change.startsWith('-') ? 'var(--danger)' : 'var(--success)';
                    return currentMarketPrice;
                }
            } catch (e) { console.error("Price fetch failed"); }
        }

        function executeTrade(type) {
            const qty = parseInt(document.getElementById('tradeQty').value);
            const sym = document.getElementById('activeSym').innerText;
            const totalCost = qty * currentMarketPrice;

            if (type === 'BUY') {
                if (state.cash < totalCost) return alert("Insufficient Buying Power.");
                
                state.cash -= totalCost;
                const existing = state.portfolio.find(p => p.sym === sym);
                if (existing) {
                    // Recalculate Average Cost
                    const newTotalQty = existing.qty + qty;
                    existing.avgCost = ((existing.qty * existing.avgCost) + totalCost) / newTotalQty;
                    existing.qty = newTotalQty;
                } else {
                    state.portfolio.push({ sym, qty, avgCost: currentMarketPrice });
                }
            } else {
                const existing = state.portfolio.find(p => p.sym === sym);
                if (!existing || existing.qty < qty) return alert("Not enough shares owned.");
                
                state.cash += totalCost;
                existing.qty -= qty;
                if (existing.qty === 0) {
                    state.portfolio = state.portfolio.filter(p => p.sym !== sym);
                }
            }

            saveAndSync();
            alert(`${type} order confirmed for ${qty} shares of ${sym}`);
        }

        // --- UI SYNC ---
        function saveAndSync() {
            localStorage.setItem('nv_enterprise_v1', JSON.stringify(state));
            
            let invested = 0;
            let currentAssetValue = 0;
            
            const tbody = document.getElementById('assetTable');
            tbody.innerHTML = state.portfolio.map(p => {
                const costBasis = p.qty * p.avgCost;
                const marketVal = p.qty * currentMarketPrice; // Note: Simplified for current view ticker
                const pnl = marketVal - costBasis;
                const pnlPercent = ((pnl / costBasis) * 100).toFixed(2);
                
                invested += costBasis;
                currentAssetValue += marketVal;

                return `
                    <tr>
                        <td><b>${p.sym}</b></td>
                        <td>${p.qty}</td>
                        <td>$${p.avgCost.toFixed(2)}</td>
                        <td>$${currentMarketPrice.toFixed(2)}</td>
                        <td>$${costBasis.toFixed(2)}</td>
                        <td style="color: ${pnl >= 0 ? 'var(--success)' : 'var(--danger)'}">
                            ${pnl >= 0 ? '+' : ''}$${pnl.toFixed(2)}
                        </td>
                        <td><span class="status-pill ${pnl >= 0 ? 'gain' : 'loss'}">${pnlPercent}%</span></td>
                    </tr>
                `;
            }).join('');

            document.getElementById('cashBal').innerText = `$${state.cash.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
            document.getElementById('totalInvested').innerText = `$${invested.toLocaleString()}`;
            document.getElementById('netWorth').innerText = `$${(state.cash + currentAssetValue).toLocaleString()}`;
            
            const totalPnL = currentAssetValue - invested;
            const pnlEl = document.getElementById('totalPnL');
            pnlEl.innerText = `${totalPnL >= 0 ? '+' : ''}$${totalPnL.toFixed(2)}`;
            pnlEl.style.color = totalPnL >= 0 ? 'var(--success)' : 'var(--danger)';
        }

        function executeLookup() {
            const sym = document.getElementById('symbolIn').value.toUpperCase();
            if(!sym) return;
            document.getElementById('activeSym').innerText = sym;
            document.getElementById('activeName').innerText = `${sym} Asset Class`;
            
            new TradingView.widget({
                "autosize": true, "symbol": sym, "interval": "D", "timezone": "Etc/UTC",
                "theme": "dark", "style": "1", "container_id": "chart-box",
                "backgroundColor": "#020617", "gridColor": "rgba(255, 255, 255, 0.05)"
            });
            
            fetchPrice(sym);
            document.getElementById('symbolIn').value = "";
        }

        // INIT
        executeLookup(); // Load AAPL by default
        saveAndSync();
    </script>
</body>
</html>