<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover">
    <title>NeuroVest V17 // Mobile Optimized</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        :root {
            --bg: #050708; --panel: #0d1117; --card: #161b22;
            --accent: #00f2ff; --up: #00ff88; --down: #ff3366;
            --text: #f0f6fc; --dim: #8b949e; --border: rgba(240, 246, 252, 0.1);
        }
        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            font-family: 'Inter', sans-serif; 
            /* Fixed: Prevents zooming on fast taps */
            touch-action: manipulation; 
            -webkit-tap-highlight-color: transparent;
        }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }
        #app { display: grid; grid-template-columns: 80px 1fr 360px; height: 100vh; }

        /* MOBILE OVERRIDES */
        @media (max-width: 900px) {
            #app { grid-template-columns: 60px 1fr; }
            .trade-panel { display: none; } /* Simplified for mobile focus */
        }

        /* NOTIFICATIONS */
        #notif-container { position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .notif { 
            background: var(--card); border: 1px solid var(--border); padding: 15px 20px; border-radius: 12px; 
            color: #fff; font-size: 13px; font-weight: 700; min-width: 260px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); transform: translateX(120%); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex; align-items: center; gap: 12px; pointer-events: all;
        }
        .notif.show { transform: translateX(0); }
        .notif.success { border-left: 4px solid var(--up); }
        .notif.error { border-left: 4px solid var(--down); }

        /* SIDEBAR */
        .sidebar { background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding: 30px 0; gap: 20px; }
        .nav-item { width: 50px; height: 50px; border-radius: 12px; color: var(--dim); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; font-size: 24px; }
        .nav-item.active { background: var(--accent); color: #000; box-shadow: 0 0 20px rgba(0, 242, 255, 0.4); }

        /* VIEWS */
        .view { display: none; flex-direction: column; height: 100%; overflow: hidden; }
        .view.active { display: flex; }
        header { height: 80px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; background: var(--panel); }

        /* CHART */
        .chart-container { flex: 1; position: relative; background: #050708; }
        canvas { width: 100%; height: 100%; }

        /* WALLET */
        .wallet-header { padding: 40px; background: linear-gradient(180deg, #161b22 0%, #050708 100%); text-align: center; border-bottom: 1px solid var(--border); position: relative; }
        .total-money { font-size: clamp(32px, 8vw, 56px); font-weight: 900; letter-spacing: -2px; color: var(--accent); }
        .sell-all-btn { 
            margin-top: 15px; background: rgba(255, 51, 102, 0.1); color: var(--down); 
            border: 1px solid var(--down); padding: 10px 20px; border-radius: 10px; 
            font-size: 12px; font-weight: 800; cursor: pointer; transition: 0.2s;
        }
        .sell-all-btn:active { transform: scale(0.95); background: var(--down); color: white; }

        /* ASIDE */
        .trade-panel { background: var(--panel); border-left: 1px solid var(--border); padding: 30px; display: flex; flex-direction: column; gap: 20px; }
        .input-box { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 18px; color: #fff; font-size: 18px; font-weight: 800; width: 100%; outline: none; }
        .btn { border: none; padding: 20px; border-radius: 14px; font-weight: 900; cursor: pointer; transition: 0.2s; }
        .btn:active { transform: scale(0.96); opacity: 0.8; }
        .btn-buy { background: var(--up); color: #000; }
        .btn-sell { border: 2px solid var(--down); background: none; color: var(--down); }

        .asset-row { background: var(--card); padding: 25px; border-radius: 16px; margin: 10px 20px; display: flex; justify-content: space-between; align-items: center; transition: 0.2s; }
    </style>
</head>
<body>

<div id="notif-container"></div>

<div id="app">
    <nav class="sidebar">
        <div class="nav-item active" id="n-market" onclick="ui.view('market')"><i class="ph-fill ph-chart-line-up"></i></div>
        <div class="nav-item" id="n-wallet" onclick="ui.view('wallet')"><i class="ph-fill ph-suitcase"></i></div>
        <div class="nav-item" id="n-settings" onclick="ui.view('settings')"><i class="ph-fill ph-user-gear"></i></div>
    </nav>

    <main style="flex:1; overflow:hidden;">
        <div id="view-market" class="view active">
            <header>
                <select id="stockPicker" onchange="sim.changeStock(this.value)" style="background:none; border:none; color:#fff; font-size:20px; font-weight:900; outline:none;">
                    <option value="ODD">ODDITY Tech (ODD)</option>
                    <option value="TSLA">Tesla (TSLA)</option>
                    <option value="BRK.A">Berkshire (BRK.A)</option>
                    <option value="JSDA">Jones Soda (JSDA)</option>
                </select>
            </header>
            <div class="chart-container"><canvas id="mainChart"></canvas></div>
        </div>

        <div id="view-wallet" class="view">
            <div class="wallet-header">
                <p style="font-size:11px; color:var(--dim); font-weight:800; text-transform:uppercase;">Net Worth</p>
                <div class="total-money" id="netWorthDisplay">$0.00</div>
                <div id="walletCashDisp" style="color:var(--up); font-weight:700; margin-top:5px;">Cash: $0.00</div>
                <button class="sell-all-btn" onclick="sim.sellAll()">SELL ALL ASSETS</button>
            </div>
            <div id="walletList" style="overflow-y:auto; padding-bottom:40px;"></div>
        </div>

        <div id="view-settings" class="view">
            <header><h2>Settings</h2></header>
            <div style="padding:30px;">
                <button class="btn" style="border: 1px solid var(--down); color: var(--down); width:100%;" onclick="ui.reset()">WIPE ALL DATA</button>
            </div>
        </div>
    </main>

    <aside class="trade-panel">
        <div id="sidePrice" style="font-size: 42px; font-weight: 950;">$0.00</div>
        <div id="sideChange" style="font-size: 14px; font-weight: 800;">0.00%</div>

        <div style="display:flex; flex-direction:column; gap:10px;">
            <label style="font-size:11px; color:var(--dim)">SHARES</label>
            <input type="number" id="tradeQty" value="1" class="input-box">
            <button class="btn btn-buy" onclick="sim.trade('buy')">BUY</button>
            <button class="btn btn-sell" onclick="sim.trade('sell')">SELL</button>
        </div>
    </aside>
</div>

<script>
    const sim = {
        ticker: 'ODD',
        db: JSON.parse(localStorage.getItem('nv_v17')) || { cash: 10000, portfolio: {ODD: 0, TSLA: 0, "BRK.A": 0, JSDA: 0} },
        stocks: {
            'ODD': { p: 13.75, vol: 0.12, bias: -0.78 },
            'TSLA': { p: 405.00, vol: 0.02, bias: -0.02 },
            'BRK.A': { p: 753140, vol: 0.001, bias: 0.03 },
            'JSDA': { p: 0.31, vol: 0.18, bias: 0.05 }
        },
        hist: [],

        init() {
            this.canvas = document.getElementById('mainChart');
            this.ctx = this.canvas.getContext('2d');
            window.addEventListener('resize', () => this.resize());
            this.resize();
            this.generate();
            this.loop();
            ui.update();
        },

        generate() {
            this.hist = [];
            let s = this.stocks[this.ticker];
            for(let i=0; i<150; i++) this.hist.push(s.p);
        },

        trade(type) {
            let q = parseInt(document.getElementById('tradeQty').value) || 0;
            let p = this.stocks[this.ticker].p;
            if(type === 'buy' && this.db.cash >= q*p) {
                this.db.cash -= q*p;
                this.db.portfolio[this.ticker] = (this.db.portfolio[this.ticker] || 0) + q;
                ui.notify("Bought", `${q} shares of ${this.ticker}`, "success");
            } else if(type === 'sell' && (this.db.portfolio[this.ticker] || 0) >= q) {
                this.db.cash += q*p;
                this.db.portfolio[this.ticker] -= q;
                ui.notify("Sold", `${q} shares of ${this.ticker}`, "success");
            } else {
                ui.notify("Error", "Check funds/shares", "error");
            }
            this.save();
            ui.update();
        },

        // FIXED: Sell All Button Logic
        sellAll() {
            let liquidatedCount = 0;
            for (let symbol in this.db.portfolio) {
                let amount = this.db.portfolio[symbol];
                if (amount > 0) {
                    let currentPrice = this.stocks[symbol].p;
                    this.db.cash += (amount * currentPrice);
                    this.db.portfolio[symbol] = 0;
                    liquidatedCount++;
                }
            }
            
            if(liquidatedCount > 0) {
                ui.notify("Panic Sell", "All assets converted to cash", "error");
                this.save();
                ui.update();
                ui.renderWallet();
            } else {
                ui.notify("Clear", "No assets to sell", "success");
            }
        },

        changeStock(v) { this.ticker = v; this.generate(); ui.update(); },
        save() { localStorage.setItem('nv_v17', JSON.stringify(this.db)); },
        resize() {
            this.canvas.width = this.canvas.offsetWidth * window.devicePixelRatio;
            this.canvas.height = this.canvas.offsetHeight * window.devicePixelRatio;
            this.ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
        },

        loop() {
            setInterval(() => {
                let s = this.stocks[this.ticker];
                s.p *= (1 + (Math.random()-0.5)*(s.vol/20));
                this.hist.push(s.p);
                this.hist.shift();
                ui.update();
            }, 600);
            this.draw();
        },

        draw() {
            let ctx = this.ctx; let w = this.canvas.width/window.devicePixelRatio; let h = this.canvas.height/window.devicePixelRatio;
            ctx.clearRect(0,0,w,h);
            let min = Math.min(...this.hist), max = Math.max(...this.hist), range = (max - min) || 1;
            let color = this.hist[0] < this.hist[this.hist.length-1] ? '#00ff88' : '#ff3366';
            ctx.beginPath(); ctx.strokeStyle = color; ctx.lineWidth = 3; ctx.lineJoin = 'round';
            this.hist.forEach((v, i) => {
                let x = (i/(this.hist.length-1))*w;
                let y = h - ((v-min)/range)*(h*0.8) - (h*0.1);
                if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
            });
            ctx.stroke();
            requestAnimationFrame(() => this.draw());
        }
    };

    const ui = {
        view(id) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(v => v.classList.remove('active'));
            document.getElementById('view-'+id).classList.add('active');
            document.getElementById('n-'+id).classList.add('active');
            if(id === 'wallet') this.renderWallet();
        },
        notify(title, msg, type) {
            const container = document.getElementById('notif-container');
            const el = document.createElement('div');
            el.className = `notif ${type}`;
            el.innerHTML = `<div><div style="font-weight:900">${title}</div><div style="font-size:11px">${msg}</div></div>`;
            container.appendChild(el);
            setTimeout(() => el.classList.add('show'), 10);
            setTimeout(() => { el.classList.remove('show'); setTimeout(() => el.remove(), 400); }, 2500);
        },
        update() {
            let s = sim.stocks[sim.ticker];
            document.getElementById('sidePrice').innerText = `$${s.p.toLocaleString(undefined, {minimumFractionDigits: s.p < 1 ? 4 : 2})}`;
            let totalVal = sim.db.cash;
            for(let k in sim.stocks) totalVal += (sim.db.portfolio[k] || 0) * sim.stocks[k].p;
            document.getElementById('netWorthDisplay').innerText = `$${totalVal.toLocaleString(undefined, {maximumFractionDigits:2})}`;
            document.getElementById('walletCashDisp').innerText = `Cash: $${sim.db.cash.toLocaleString()}`;
        },
        renderWallet() {
            let list = document.getElementById('walletList');
            list.innerHTML = "";
            for(let k in sim.stocks) {
                let shares = sim.db.portfolio[k] || 0;
                if(shares <= 0) continue;
                list.innerHTML += `<div class="asset-row"><div><b>${k}</b><br><small>${shares} Shares</small></div><div>$${(shares * sim.stocks[k].p).toLocaleString()}</div></div>`;
            }
        },
        reset() { localStorage.clear(); location.reload(); }
    };
    window.onload = () => sim.init();
</script>
</body>
</html>