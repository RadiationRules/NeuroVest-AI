<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <title>NeuroVest // Kinetic Pro V8</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        :root {
            --bg: #0b0e11; --panel: #15191e; --card: #1e2329;
            --accent: #00ffcc; --up: #00ff88; --down: #ff3366;
            --text: #ffffff; --dim: #848e9c; --border: rgba(255,255,255,0.08);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: var(--text); height: 100dvh; overflow: hidden; }

        #app { display: grid; grid-template-columns: 75px 1fr 340px; height: 100vh; width: 100vw; }

        /* SIDEBAR */
        .sidebar { background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding: 25px 0; gap: 15px; z-index: 100; }
        .nav-item { width: 50px; height: 50px; border-radius: 14px; color: var(--dim); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); font-size: 24px; }
        .nav-item:hover { color: #fff; transform: translateY(-2px); }
        .nav-item.active { background: var(--accent); color: #000; box-shadow: 0 10px 20px rgba(0, 255, 204, 0.3); }

        /* VIEWS */
        .view-container { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .view { display: none; flex-direction: column; height: 100%; width: 100%; }
        .view.active { display: flex; }

        header { height: 75px; border-bottom: 1px solid var(--border); background: var(--panel); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; }
        .avatar { width: 38px; height: 38px; border-radius: 50%; border: 2px solid var(--accent); object-fit: cover; }

        /* CHART AREA */
        .chart-area { flex: 1; position: relative; background: radial-gradient(circle at 50% 10%, #1e2329 0%, #0b0e11 100%); }
        canvas { width: 100%; height: 100%; }

        /* WALLET VIEW GRID */
        .wallet-grid { padding: 30px; display: grid; gap: 15px; overflow-y: auto; }
        .market-card { background: var(--card); padding: 20px; border-radius: 18px; border: 1px solid var(--border); display: grid; grid-template-columns: 1fr 1fr; align-items: center; transition: 0.2s; cursor: pointer; }
        .market-card:hover { border-color: var(--accent); background: #252a32; }

        /* ORDER PANEL (FIXED UI) */
        .order-panel { background: var(--panel); border-left: 1px solid var(--border); padding: 30px; display: flex; flex-direction: column; gap: 15px; }
        .price-hero { font-size: 40px; font-weight: 900; letter-spacing: -1.5px; margin-bottom: 10px; }
        
        .btn-buy { background: var(--up); color: #000; border: none; padding: 20px; border-radius: 15px; font-weight: 900; cursor: pointer; font-size: 16px; box-shadow: 0 4px 15px rgba(0,255,136,0.2); }
        .btn-sell { background: transparent; border: 2px solid var(--down); color: var(--down); padding: 18px; border-radius: 15px; font-weight: 900; cursor: pointer; }
        .btn-buy:active, .btn-sell:active { transform: scale(0.96); }

        /* DYNAMIC STATS UNDER BUTTONS */
        .live-stats-box { background: rgba(255,255,255,0.03); border-radius: 15px; padding: 18px; margin-top: 10px; border: 1px dashed var(--border); }
        .stat-line { display: flex; justify-content: space-between; margin-bottom: 8px; }
        .stat-line:last-child { margin-bottom: 0; }
        .label { font-size: 11px; font-weight: 800; color: var(--dim); text-transform: uppercase; }
        .value { font-size: 14px; font-weight: 900; }

        #settingsDrawer { position: fixed; top: 0; right: -420px; width: 400px; height: 100%; background: var(--panel); border-left: 1px solid var(--border); z-index: 2000; transition: 0.5s cubic-bezier(0.16, 1, 0.3, 1); padding: 50px 40px; }
        #settingsDrawer.open { right: 0; box-shadow: -50px 0 100px rgba(0,0,0,0.6); }

        .input-box { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 15px; color: #fff; width: 100%; outline: none; margin-top: 8px; font-size: 16px; }
    </style>
</head>
<body>

<div id="app">
    <nav class="sidebar">
        <div class="nav-item active" id="nav-m" onclick="ui.switchView('market')"><i class="ph-fill ph-chart-line-up"></i></div>
        <div class="nav-item" id="nav-w" onclick="ui.switchView('wallet')"><i class="ph-fill ph-wallet"></i></div>
        <div class="nav-item" onclick="ui.toggleSettings()"><i class="ph-fill ph-gear-six"></i></div>
    </nav>

    <div class="view-container">
        <div id="view-market" class="view active">
            <header>
                <div style="display:flex; align-items:center; gap:20px;">
                    <select id="stockSelect" onchange="sim.changeStock(this.value)" style="background:none; border:none; color:#fff; font-size:24px; font-weight:900; outline:none; cursor:pointer;">
                        <option value="JSDA">JSDA / Soda</option>
                        <option value="TSLA">TSLA / Tesla</option>
                        <option value="BRK.A">BRK.A / Berkshire</option>
                        <option value="ODD">ODD / Oddity</option>
                    </select>
                </div>
                <div class="user-trigger" onclick="ui.toggleSettings()" style="display:flex; align-items:center; gap:12px; cursor:pointer;">
                    <span id="userNameDisp" style="font-size:13px; font-weight:800; letter-spacing:0.5px;">TRADER</span>
                    <img id="userImgDisp" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="avatar">
                </div>
            </header>
            <div class="chart-area"><canvas id="mainChart"></canvas></div>
        </div>

        <div id="view-wallet" class="view">
            <header><h2>Market Overview</h2></header>
            <div class="wallet-grid" id="walletList"></div>
        </div>
    </div>

    <aside class="order-panel">
        <div id="sidePrice" class="price-hero">$0.00</div>
        
        <div style="display:flex; flex-direction:column; gap:12px;">
            <div class="input-wrap">
                <label class="label">Amount of Shares</label>
                <input type="number" id="qty" value="1" class="input-box">
            </div>
            <button class="btn-buy" onclick="sim.trade('buy')">BUY ORDER</button>
            <button class="btn-sell" onclick="sim.trade('sell')">SELL ORDER</button>
        </div>

        <div class="live-stats-box">
            <div class="stat-line">
                <span class="label">Cash Balance</span>
                <span id="cashDisp" class="value" style="color:var(--accent)">$0.00</span>
            </div>
            <div class="stat-line">
                <span class="label">Owned Shares</span>
                <span id="unitsDisp" class="value">0</span>
            </div>
            <div class="stat-line">
                <span class="label">Total PNL</span>
                <span id="pnlDisp" class="value">$0.00</span>
            </div>
        </div>
    </aside>
</div>

<div id="settingsDrawer">
    <i class="ph ph-x" onclick="ui.toggleSettings()" style="cursor:pointer; font-size:28px;"></i>
    <h2 style="margin:40px 0 20px 0; font-weight:900; font-size:32px;">PROFILE</h2>
    <label class="label">Trader Alias</label>
    <input type="text" id="nameInput" class="input-box" oninput="ui.saveProfile()">
    <label class="label" style="display:block; margin-top:25px;">Avatar Image</label>
    <input type="file" id="avatarUpload" onchange="ui.handleAvatar(this)" style="margin-top:10px;">
    <button onclick="ui.resetAll()" style="margin-top:60px; color:var(--down); background:none; border:none; cursor:pointer; font-weight:800;">WIPE TERMINAL DATA</button>
</div>

<script>
    const sim = {
        active: 'TSLA',
        data: JSON.parse(localStorage.getItem('nv_v8')) || {
            cash: 100000,
            portfolio: { 'JSDA': 0, 'TSLA': 0, 'BRK.A': 0, 'ODD': 0 },
            avgCosts: { 'JSDA': 0, 'TSLA': 0, 'BRK.A': 0, 'ODD': 0 },
            name: "New Trader",
            avatar: null
        },
        stocks: {
            'JSDA': { p: 0.45, vol: 0.012, hist: [], precision: 4 },
            'TSLA': { p: 185.00, vol: 0.003, hist: [], precision: 2 },
            'BRK.A': { p: 615000, vol: 0.0005, hist: [], precision: 0 },
            'ODD': { p: 15.00, vol: 0.006, hist: [], precision: 2 }
        },

        init() {
            this.canvas = document.getElementById('mainChart');
            this.ctx = this.canvas.getContext('2d');
            
            // Generate distinct histories
            for(let s in this.stocks) {
                const stk = this.stocks[s];
                if(s === 'ODD') { // Special ODD Cliff Drop
                    for(let i=0; i<150; i++) stk.hist.push(40 + Math.random()*15);
                    for(let i=0; i<30; i++) stk.hist.push(stk.hist[stk.hist.length-1] * 0.7);
                    for(let i=0; i<100; i++) stk.hist.push(15 + (Math.random()-0.5));
                } else {
                    for(let i=0; i<280; i++) {
                        stk.p += stk.p * (stk.vol * (Math.random() - 0.5));
                        stk.hist.push(stk.p);
                    }
                }
            }

            ui.loadProfile();
            this.resize();
            window.onresize = () => this.resize();
            setInterval(() => this.tick(), 250);
            this.animate();
        },

        tick() {
            for(let s in this.stocks) {
                const stk = this.stocks[s];
                let mv = (stk.vol * (Math.random() - 0.5));
                if(s === 'JSDA' && Math.random() > 0.97) mv += 0.4; // Penny stock spike
                stk.p += stk.p * mv;
                stk.hist.push(stk.p);
                if(stk.hist.length > 300) stk.hist.shift();
            }
            this.save();
            this.updateUI();
        },

        trade(type) {
            const qty = parseInt(document.getElementById('qty').value) || 0;
            const stk = this.stocks[this.active];
            const cost = qty * stk.p;

            if(type === 'buy' && this.data.cash >= cost && qty > 0) {
                const totalCost = (this.data.avgCosts[this.active] * this.data.portfolio[this.active]) + cost;
                this.data.portfolio[this.active] += qty;
                this.data.avgCosts[this.active] = totalCost / this.data.portfolio[this.active];
                this.data.cash -= cost;
            } else if(type === 'sell' && this.data.portfolio[this.active] >= qty && qty > 0) {
                this.data.cash += cost;
                this.data.portfolio[this.active] -= qty;
                if(this.data.portfolio[this.active] === 0) this.data.avgCosts[this.active] = 0;
            }
            this.save();
            this.updateUI();
        },

        save() { localStorage.setItem('nv_v8', JSON.stringify(this.data)); },

        updateUI() {
            const stk = this.stocks[this.active];
            const pStr = `$${stk.p.toLocaleString(undefined, {minimumFractionDigits: stk.precision})}`;
            document.getElementById('sidePrice').innerText = pStr;
            document.getElementById('cashDisp').innerText = `$${Math.floor(this.data.cash).toLocaleString()}`;
            document.getElementById('unitsDisp').innerText = `${this.data.portfolio[this.active]} Shares`;
            
            const pnl = (stk.p - this.data.avgCosts[this.active]) * this.data.portfolio[this.active];
            const pnlEl = document.getElementById('pnlDisp');
            pnlEl.innerText = (pnl >= 0 ? '+$' : '-$') + Math.abs(pnl).toFixed(2);
            pnlEl.style.color = pnl >= 0 ? 'var(--up)' : 'var(--down)';

            if(document.getElementById('view-wallet').classList.contains('active')) ui.renderWallet();
        },

        changeStock(val) { this.active = val; this.updateUI(); },
        resize() { this.canvas.width = this.canvas.offsetWidth; this.canvas.height = this.canvas.offsetHeight; },

        animate() {
            const ctx = this.ctx; const h = this.canvas.height; const w = this.canvas.width;
            const hist = this.stocks[this.active].hist;
            ctx.clearRect(0,0,w,h);
            const min = Math.min(...hist); const max = Math.max(...hist); const range = (max - min) || 1;
            ctx.beginPath(); ctx.strokeStyle = '#00ffcc'; ctx.lineWidth = 4;
            for(let i=0; i<hist.length; i++) {
                const x = (i / (hist.length-1)) * w;
                const y = h - ((hist[i] - min) / range) * (h * 0.7) - (h * 0.15);
                if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
            }
            ctx.stroke();
            const g = ctx.createLinearGradient(0,0,0,h);
            g.addColorStop(0, 'rgba(0, 255, 204, 0.15)'); g.addColorStop(1, 'transparent');
            ctx.fillStyle = g; ctx.lineTo(w, h); ctx.lineTo(0, h); ctx.fill();
            requestAnimationFrame(() => this.animate());
        }
    };

    const ui = {
        switchView(id) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('view-'+id).classList.add('active');
            document.getElementById('nav-'+id[0]).classList.add('active');
            if(id === 'wallet') this.renderWallet();
        },
        toggleSettings() { document.getElementById('settingsDrawer').classList.toggle('open'); },
        loadProfile() {
            document.getElementById('userNameDisp').innerText = sim.data.name;
            document.getElementById('nameInput').value = sim.data.name;
            if(sim.data.avatar) document.getElementById('userImgDisp').src = sim.data.avatar;
        },
        saveProfile() { sim.data.name = document.getElementById('nameInput').value; this.loadProfile(); sim.save(); },
        handleAvatar(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    sim.data.avatar = e.target.result;
                    document.getElementById('userImgDisp').src = e.target.result;
                    sim.save();
                };
                reader.readAsDataURL(input.files[0]);
            }
        },
        renderWallet() {
            const list = document.getElementById('walletList');
            list.innerHTML = "";
            for(let s in sim.stocks) {
                const stk = sim.stocks[s];
                const owned = sim.data.portfolio[s];
                list.innerHTML += `
                    <div class="market-card" onclick="sim.changeStock('${s}'); ui.switchView('market')">
                        <div>
                            <h3 style="font-weight:900; color:var(--accent)">${s}</h3>
                            <p style="font-size:12px; color:var(--dim)">${owned} Shares Owned</p>
                        </div>
                        <div style="text-align:right">
                            <div style="font-weight:900; font-size:18px;">$${stk.p.toLocaleString(undefined, {minimumFractionDigits: stk.precision})}</div>
                            <div style="font-size:11px; color:var(--up)">View Chart</div>
                        </div>
                    </div>
                `;
            }
        },
        resetAll() { localStorage.clear(); location.reload(); }
    };
    window.onload = () => sim.init();
</script>
</body>
</html>